<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Whisper MP3 ä¸Šä¼ æµ‹è¯•</title>
</head>
<body>
  <h2>ğŸ¤ ä¸Šä¼ é›…æ€å£è¯­ MP3 æ–‡ä»¶</h2>
  <input type="file" id="fileInput" accept=".mp3" />
  <button onclick="uploadFile()">ä¸Šä¼ å¹¶è¯†åˆ«</button>

  <h3>ğŸ¯ è¯†åˆ«ç»“æœï¼š</h3>
  <pre id="resultText" style="white-space: pre-wrap; word-break: break-word;"></pre>

  <button onclick="copyResult()">ğŸ“‹ å¤åˆ¶è¯†åˆ«ç»“æœ</button>
  <button onclick="exportToWord()">ğŸ“„ å¯¼å‡ºä¸º Word æ–‡ä»¶</button>

  <script>
    async function uploadFile() {
      const fileInput = document.getElementById("fileInput");
      const resultText = document.getElementById("resultText");

      if (!fileInput.files.length) {
        alert("è¯·é€‰æ‹©ä¸€ä¸ª MP3 æ–‡ä»¶ï¼");
        return;
      }

      const formData = new FormData();
      formData.append("file", fileInput.files[0]);

      resultText.textContent = "è¯†åˆ«ä¸­ï¼Œè¯·ç¨å€™...";

      try {
        const response = await fetch("https://whisper-api-server.onrender.com/transcribe", {
          method: "POST",
          body: formData
        });

        const data = await response.json();
        resultText.textContent = data.text || "æœªèƒ½è¯†åˆ«æˆåŠŸã€‚";
      } catch (error) {
        resultText.textContent = "å‡ºé”™äº†ï¼š" + error;
      }
    }

    function copyResult() {
      const text = document.getElementById("resultText").textContent;
      navigator.clipboard.writeText(text).then(() => {
        alert("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼");
      }).catch(err => {
        alert("å¤åˆ¶å¤±è´¥ï¼š" + err);
      });
    }

    function exportToWord() {
      const text = document.getElementById("resultText").textContent;
      const blob = new Blob([`\ufeff${text}`], { type: "application/msword" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "IELTS-Transcription.doc";
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>

